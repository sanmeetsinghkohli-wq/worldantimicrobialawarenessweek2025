<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Frame Photo Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        /* Canvas Container */
        .canvas-wrapper {
            background: #f5f5f5;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        #canvas {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            background: white;
        }

        /* Camera Modal */
        .camera-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            overflow-y: auto;
        }

        .camera-modal.active {
            display: flex;
        }

        .camera-container {
            position: relative;
            max-width: 90%;
            max-height: 70vh;
        }

        #video {
            width: 100%;
            max-width: 640px;
            border-radius: 10px;
            transform: scaleX(-1);
        }

        #capturedImage {
            display: none;
            max-width: 640px;
            width: 100%;
            border-radius: 10px;
        }

        #captureCanvas {
            display: none;
        }

        .camera-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
            flex-wrap: wrap;
            padding: 10px;
        }

        .camera-btn {
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .capture-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .use-photo-btn {
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
            color: white;
        }

        .retake-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }

        .close-camera-btn {
            background: #666;
            color: white;
        }

        .switch-camera-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .camera-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* Action Buttons */
        .action-section {
            margin-bottom: 25px;
        }

        .action-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
            text-align: center;
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .btn {
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn-camera {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-upload {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
            color: white;
        }

        .btn-email {
            background: linear-gradient(135deg, #ea4335 0%, #d32f2f 100%);
            color: white;
        }

        .btn-download {
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
            color: white;
        }

        .btn-reset {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        input[type="file"] {
            display: none;
        }

        /* Share Section */
        .share-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            display: none;
        }

        .share-section.active {
            display: block;
        }

        .share-section h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-size: 20px;
        }

        .share-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Status Message */
        .status-message {
            text-align: center;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 10px;
            display: none;
            font-weight: 500;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .status-message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }

        .camera-info {
            color: white;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
        }

        /* Info Box */
        .info-box {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: center;
        }

        .info-box p {
            color: #8b4513;
            font-size: 15px;
            margin: 8px 0;
        }

        .info-box strong {
            color: #5d2e0f;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.5em;
            }

            .button-grid,
            .share-buttons {
                grid-template-columns: 1fr;
            }

            .camera-controls {
                flex-direction: column;
                width: 100%;
            }

            .camera-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì∏ Digital Frame Photo Generator</h1>
        <p class="subtitle">Take a selfie or upload a photo!</p>

        <!-- Info Box -->
        <div class="info-box">
            <p><strong>‚ú® Perfect Circle Fit</strong></p>
            <p>Your photo will be automatically centered in a perfect circle!</p>
        </div>

        <!-- Status Message -->
        <div id="statusMessage" class="status-message"></div>

        <!-- Canvas -->
        <div class="canvas-wrapper">
            <canvas id="canvas"></canvas>
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p style="margin-top: 10px; color: #666;">Processing...</p>
            </div>
        </div>

        <!-- Upload Section -->
        <div class="action-section">
            <h3>üì§ Upload Your Photo</h3>
            <div class="button-grid">
                <input type="file" id="fileInput" accept="image/*">
                
                <button class="btn btn-camera" id="openCameraBtn">
                    üì∑ Take Selfie
                </button>
                
                <button class="btn btn-upload" onclick="document.getElementById('fileInput').click()">
                    üìÅ Upload Photo
                </button>
            </div>
        </div>

        <!-- Share Section -->
        <div class="share-section" id="shareSection">
            <h3>üì§ Share Your Framed Photo</h3>
            <div class="share-buttons">
                <button class="btn btn-whatsapp" id="shareWhatsAppBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                    </svg>
                    Share on WhatsApp
                </button>
                
                <button class="btn btn-email" id="shareEmailBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                    </svg>
                    Share via Email
                </button>
                
                <button class="btn btn-download" id="downloadBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"/>
                    </svg>
                    Download Image
                </button>
            </div>
        </div>

        <!-- Reset Button -->
        <div class="button-grid">
            <button class="btn btn-reset" id="resetBtn">
                üîÑ Start Over
            </button>
        </div>
    </div>

    <!-- Camera Modal -->
    <div class="camera-modal" id="cameraModal">
        <div class="camera-container">
            <video id="video" autoplay playsinline></video>
            <img id="capturedImage" />
            <canvas id="captureCanvas"></canvas>
        </div>
        <div class="camera-info" id="cameraInfo">Position yourself and click capture</div>
        <div class="camera-controls">
            <button class="camera-btn capture-btn" id="captureBtn">
                üì∏ Capture Photo
            </button>
            <button class="camera-btn retake-btn" id="retakeBtn" style="display: none;">
                üîÑ Retake
            </button>
            <button class="camera-btn use-photo-btn" id="usePhotoBtn" style="display: none;">
                ‚úÖ Use This Photo
            </button>
            <button class="camera-btn switch-camera-btn" id="switchCameraBtn">
                üîÑ Switch Camera
            </button>
            <button class="camera-btn close-camera-btn" id="closeCameraBtn">
                ‚ùå Close
            </button>
        </div>
    </div>

    <script>
        // ========================================
        // CONFIGURATION
        // ========================================
        const CONFIG = {
            frameImage: 'digitalframe.png',
            // Auto-detect circle - will be set when frame loads
            circle: {
                centerX: null,
                centerY: null,
                radius: null
            }
        };

        // ========================================
        // GLOBAL VARIABLES
        // ========================================
        let canvas, ctx;
        let frameImg = null;
        let userPhoto = null;
        let finalImageDataUrl = null;

        // Camera variables
        let videoStream = null;
        let currentFacingMode = 'user';
        let capturedImageData = null;

        // ========================================
        // INITIALIZATION
        // ========================================
        document.addEventListener('DOMContentLoaded', function() {
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            
            loadFrameImage();
            bindEvents();
        });

        // ========================================
        // FRAME LOADING
        // ========================================
        function loadFrameImage() {
            showLoading(true);
            frameImg = new Image();
            
            frameImg.onload = function() {
                canvas.width = frameImg.width;
                canvas.height = frameImg.height;
                
                // Auto-detect circle in center
                CONFIG.circle = {
                    centerX: frameImg.width / 2,
                    centerY: frameImg.height / 2,
                    radius: Math.min(frameImg.width, frameImg.height) * 0.35
                };
                
                drawCanvas();
                showLoading(false);
                showStatus('Frame loaded! Take a photo or upload one to begin.', 'info');
            };
            
            frameImg.onerror = function() {
                showLoading(false);
                showStatus('Error loading frame image. Please check if digitalframe.png exists.', 'error');
            };
            
            frameImg.src = CONFIG.frameImage;
        }

        // ========================================
        // CAMERA FUNCTIONS
        // ========================================
        async function openCamera() {
            const modal = document.getElementById('cameraModal');
            const video = document.getElementById('video');
            
            modal.classList.add('active');
            
            try {
                const constraints = {
                    video: {
                        facingMode: currentFacingMode,
                        width: { ideal: 1920 },
                        height: { ideal: 1080 }
                    },
                    audio: false
                };
                
                videoStream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = videoStream;
                
                showStatus('Camera ready! Position yourself and click capture.', 'success');
            } catch (error) {
                console.error('Camera error:', error);
                showStatus('Unable to access camera. Please check permissions.', 'error');
                closeCamera();
            }
        }

        function capturePhoto() {
            const video = document.getElementById('video');
            const captureCanvas = document.getElementById('captureCanvas');
            const capturedImage = document.getElementById('capturedImage');
            const captureBtn = document.getElementById('captureBtn');
            const retakeBtn = document.getElementById('retakeBtn');
            const usePhotoBtn = document.getElementById('usePhotoBtn');
            const cameraInfo = document.getElementById('cameraInfo');
            
            captureCanvas.width = video.videoWidth;
            captureCanvas.height = video.videoHeight;
            
            const captureCtx = captureCanvas.getContext('2d');
            
            // Mirror effect for selfie
            captureCtx.translate(captureCanvas.width, 0);
            captureCtx.scale(-1, 1);
            captureCtx.drawImage(video, 0, 0);
            
            capturedImageData = captureCanvas.toDataURL('image/png');
            
            capturedImage.src = capturedImageData;
            capturedImage.style.display = 'block';
            video.style.display = 'none';
            
            captureBtn.style.display = 'none';
            retakeBtn.style.display = 'inline-flex';
            usePhotoBtn.style.display = 'inline-flex';
            
            cameraInfo.textContent = 'Like this photo? Use it or retake.';
        }

        function retakePhoto() {
            const video = document.getElementById('video');
            const capturedImage = document.getElementById('capturedImage');
            const captureBtn = document.getElementById('captureBtn');
            const retakeBtn = document.getElementById('retakeBtn');
            const usePhotoBtn = document.getElementById('usePhotoBtn');
            const cameraInfo = document.getElementById('cameraInfo');
            
            video.style.display = 'block';
            capturedImage.style.display = 'none';
            
            captureBtn.style.display = 'inline-flex';
            retakeBtn.style.display = 'none';
            usePhotoBtn.style.display = 'none';
            
            cameraInfo.textContent = 'Position yourself and click capture';
            capturedImageData = null;
        }

        function usePhoto() {
            if (!capturedImageData) return;
            
            const img = new Image();
            img.onload = function() {
                userPhoto = img;
                drawPhotoInCircle();
                closeCamera();
                showStatus('Photo captured and perfectly fitted in the circle!', 'success');
                document.getElementById('shareSection').classList.add('active');
            };
            img.src = capturedImageData;
        }

        async function switchCamera() {
            currentFacingMode = currentFacingMode === 'user' ? 'environment' : 'user';
            
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
            }
            
            await openCamera();
        }

        function closeCamera() {
            const modal = document.getElementById('cameraModal');
            const video = document.getElementById('video');
            const capturedImage = document.getElementById('capturedImage');
            
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
                videoStream = null;
            }
            
            video.srcObject = null;
            video.style.display = 'block';
            capturedImage.style.display = 'none';
            capturedImageData = null;
            
            document.getElementById('captureBtn').style.display = 'inline-flex';
            document.getElementById('retakeBtn').style.display = 'none';
            document.getElementById('usePhotoBtn').style.display = 'none';
            
            modal.classList.remove('active');
        }

        // ========================================
        // EVENT BINDINGS
        // ========================================
        function bindEvents() {
            document.getElementById('openCameraBtn').addEventListener('click', openCamera);
            document.getElementById('captureBtn').addEventListener('click', capturePhoto);
            document.getElementById('retakeBtn').addEventListener('click', retakePhoto);
            document.getElementById('usePhotoBtn').addEventListener('click', usePhoto);
            document.getElementById('switchCameraBtn').addEventListener('click', switchCamera);
            document.getElementById('closeCameraBtn').addEventListener('click', closeCamera);
            
            document.getElementById('fileInput').addEventListener('change', handleFileSelect);
            document.getElementById('downloadBtn').addEventListener('click', downloadImage);
            document.getElementById('shareWhatsAppBtn').addEventListener('click', shareToWhatsApp);
            document.getElementById('shareEmailBtn').addEventListener('click', shareToEmail);
            document.getElementById('resetBtn').addEventListener('click', resetAll);
        }

        // ========================================
        // FILE UPLOAD
        // ========================================
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showStatus('Please select an image file', 'error');
                return;
            }
            
            showLoading(true);
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    userPhoto = img;
                    drawPhotoInCircle();
                    showLoading(false);
                    showStatus('Photo uploaded and perfectly fitted in the circle!', 'success');
                    document.getElementById('shareSection').classList.add('active');
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
            
            e.target.value = '';
        }

        // ========================================
        // DRAWING FUNCTION - CIRCULAR PHOTO
        // ========================================
        function drawPhotoInCircle() {
            if (!userPhoto || !frameImg) return;
            
            drawCanvas();
            finalImageDataUrl = canvas.toDataURL('image/png');
        }

        function drawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw user photo in circle FIRST (behind frame)
            if (userPhoto) {
                ctx.save();
                
                // Create circular clipping path
                ctx.beginPath();
                ctx.arc(
                    CONFIG.circle.centerX, 
                    CONFIG.circle.centerY, 
                    CONFIG.circle.radius,
                    0, 
                    Math.PI * 2
                );
                ctx.closePath();
                ctx.clip();
                
                // Calculate dimensions to cover the circle area
                const diameter = CONFIG.circle.radius * 2;
                const photoAspect = userPhoto.width / userPhoto.height;
                
                let drawWidth, drawHeight;
                
                // Scale to cover the circle completely
                if (photoAspect > 1) {
                    // Landscape photo
                    drawHeight = diameter;
                    drawWidth = drawHeight * photoAspect;
                } else {
                    // Portrait or square photo
                    drawWidth = diameter;
                    drawHeight = drawWidth / photoAspect;
                }
                
                // Ensure coverage
                if (drawWidth < diameter) {
                    drawWidth = diameter;
                    drawHeight = drawWidth / photoAspect;
                }
                if (drawHeight < diameter) {
                    drawHeight = diameter;
                    drawWidth = drawHeight * photoAspect;
                }
                
                // Center the photo in the circle
                const photoX = CONFIG.circle.centerX - drawWidth / 2;
                const photoY = CONFIG.circle.centerY - drawHeight / 2;
                
                // Draw the photo
                ctx.drawImage(
                    userPhoto,
                    photoX,
                    photoY,
                    drawWidth,
                    drawHeight
                );
                
                ctx.restore();
            }
            
            // Draw frame ON TOP
            if (frameImg) {
                ctx.drawImage(frameImg, 0, 0, canvas.width, canvas.height);
            }
        }

        // ========================================
        // SHARING FUNCTIONS
        // ========================================
        function downloadImage() {
            if (!finalImageDataUrl) {
                finalImageDataUrl = canvas.toDataURL('image/png');
            }
            
            const link = document.createElement('a');
            link.download = `framed-photo-${Date.now()}.png`;
            link.href = finalImageDataUrl;
            link.click();
            showStatus('Image downloaded successfully!', 'success');
        }

        async function shareToWhatsApp() {
            if (!finalImageDataUrl) {
                showStatus('Please upload or capture a photo first', 'error');
                return;
            }
            
            try {
                const blob = await (await fetch(finalImageDataUrl)).blob();
                const file = new File([blob], 'framed-photo.png', { type: 'image/png' });
                
                if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                    await navigator.share({
                        files: [file],
                        title: 'My Framed Photo',
                        text: 'Check out my photo in this beautiful frame!'
                    });
                    showStatus('Shared successfully!', 'success');
                } else {
                    const text = encodeURIComponent('Check out my framed photo!');
                    const whatsappUrl = `https://wa.me/?text=${text}`;
                    window.open(whatsappUrl, '_blank');
                    downloadImage();
                    showStatus('Opening WhatsApp... Image downloaded. Please attach it manually.', 'info');
                }
            } catch (error) {
                const text = encodeURIComponent('Check out my framed photo!');
                const whatsappUrl = `https://wa.me/?text=${text}`;
                window.open(whatsappUrl, '_blank');
                downloadImage();
                showStatus('Opening WhatsApp... Image downloaded. Please attach manually.', 'info');
            }
        }

        async function shareToEmail() {
            if (!finalImageDataUrl) {
                showStatus('Please upload or capture a photo first', 'error');
                return;
            }
            
            try {
                const blob = await (await fetch(finalImageDataUrl)).blob();
                const file = new File([blob], 'framed-photo.png', { type: 'image/png' });
                
                if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                    await navigator.share({
                        files: [file],
                        title: 'My Framed Photo',
                        text: 'Check out my photo in this beautiful frame!'
                    });
                    showStatus('Shared successfully!', 'success');
                } else {
                    const subject = encodeURIComponent('My Framed Photo');
                    const body = encodeURIComponent('Check out my photo in this beautiful frame!\n\n(Image attached separately)');
                    const mailtoUrl = `mailto:?subject=${subject}&body=${body}`;
                    window.location.href = mailtoUrl;
                    downloadImage();
                    showStatus('Opening email client... Image downloaded. Please attach it to your email.', 'info');
                }
            } catch (error) {
                const subject = encodeURIComponent('My Framed Photo');
                const body = encodeURIComponent('Check out my photo in this beautiful frame!');
                const mailtoUrl = `mailto:?subject=${subject}&body=${body}`;
                window.location.href = mailtoUrl;
                downloadImage();
                showStatus('Opening email client... Image downloaded. Please attach manually.', 'info');
            }
        }

        // ========================================
        // RESET FUNCTION
        // ========================================
        function resetAll() {
            userPhoto = null;
            finalImageDataUrl = null;
            
            document.getElementById('shareSection').classList.remove('active');
            
            drawCanvas();
            showStatus('Reset complete. Upload a new photo to begin.', 'info');
        }

        // ========================================
        // UTILITY FUNCTIONS
        // ========================================
        function showLoading(show) {
            document.getElementById('loading').classList.toggle('active', show);
        }

        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = 'status-message ' + type;
            
            setTimeout(() => {
                statusEl.className = 'status-message';
            }, 5000);
        }
    </script>
</body>
</html>
