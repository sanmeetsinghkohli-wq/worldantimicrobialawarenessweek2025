<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Frame Photo Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(255, 140, 0, 0.1);
            padding: 30px;
            border: 2px solid #ff8c00;
        }

        h1 {
            text-align: center;
            color: #ff8c00;
            margin-bottom: 30px;
            font-size: 2em;
        }

        /* Canvas Container */
        .canvas-wrapper {
            background: #fff5e6;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
            border: 2px solid #ffa500;
        }

        #canvas {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(255, 140, 0, 0.2);
            background: white;
        }

        /* Camera Modal */
        .camera-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            overflow-y: auto;
            padding: 20px;
        }

        .camera-modal.active {
            display: flex;
        }

        .camera-container {
            position: relative;
            max-width: 500px;
            width: 100%;
        }

        #video {
            width: 100%;
            max-width: 500px;
            border-radius: 10px;
            transform: scaleX(-1);
            border: 3px solid #ff8c00;
        }

        #capturedImage {
            display: none;
            max-width: 500px;
            width: 100%;
            border-radius: 10px;
            border: 3px solid #ff8c00;
        }

        #captureCanvas {
            display: none;
        }

        .camera-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
            flex-wrap: wrap;
            max-width: 500px;
            width: 100%;
        }

        .camera-btn {
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .capture-btn {
            background: linear-gradient(135deg, #ff8c00 0%, #ff6600 100%);
            color: white;
        }

        .use-photo-btn {
            background: linear-gradient(135deg, #ff8c00 0%, #ffa500 100%);
            color: white;
        }

        .retake-btn {
            background: linear-gradient(135deg, #ff6600 0%, #ff4500 100%);
            color: white;
        }

        .close-camera-btn {
            background: #666;
            color: white;
        }

        .switch-camera-btn {
            background: linear-gradient(135deg, #ffa500 0%, #ff8c00 100%);
            color: white;
        }

        .camera-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 140, 0, 0.4);
        }

        /* Action Buttons */
        .action-section {
            margin-bottom: 25px;
        }

        .action-section h3 {
            color: #ff8c00;
            margin-bottom: 15px;
            font-size: 18px;
            text-align: center;
            font-weight: 600;
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .btn {
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 6px rgba(255, 140, 0, 0.2);
        }

        .btn-camera {
            background: linear-gradient(135deg, #ff8c00 0%, #ff6600 100%);
            color: white;
        }

        .btn-upload {
            background: linear-gradient(135deg, #ffa500 0%, #ff8c00 100%);
            color: white;
        }

        .btn-share {
            background: linear-gradient(135deg, #ff8c00 0%, #ffa500 100%);
            color: white;
        }

        .btn-reset {
            background: linear-gradient(135deg, #ff6600 0%, #ff4500 100%);
            color: white;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 140, 0, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        input[type="file"] {
            display: none;
        }

        /* Adjustment Controls */
        .adjustment-section {
            background: linear-gradient(135deg, #fff5e6 0%, #ffe0b2 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            display: none;
            border: 2px solid #ffa500;
        }

        .adjustment-section.active {
            display: block;
        }

        .adjustment-section h3 {
            color: #ff8c00;
            margin-bottom: 20px;
            text-align: center;
            font-size: 20px;
            font-weight: 600;
        }

        .adjustment-controls {
            max-width: 600px;
            margin: 0 auto;
        }

        .slider-group {
            margin-bottom: 20px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            color: #555;
            font-weight: 500;
        }

        .slider-value {
            background: #ff8c00;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: 600;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ffd9a0;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #ff8c00;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(255, 140, 0, 0.3);
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 3px 8px rgba(255, 140, 0, 0.5);
        }

        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #ff8c00;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 5px rgba(255, 140, 0, 0.3);
        }

        /* Share Section */
        .share-section {
            margin-bottom: 25px;
            display: none;
        }

        .share-section.active {
            display: block;
        }

        .share-section h3 {
            color: #ff8c00;
            margin-bottom: 15px;
            font-size: 18px;
            text-align: center;
            font-weight: 600;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #ffe0b2;
            border-top: 4px solid #ff8c00;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Status Message */
        .status-message {
            text-align: center;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 10px;
            display: none;
            font-weight: 500;
        }

        .status-message.success {
            background: #fff5e6;
            color: #ff8c00;
            border: 2px solid #ffa500;
            display: block;
        }

        .status-message.error {
            background: #ffe0e0;
            color: #ff4500;
            border: 2px solid #ff6600;
            display: block;
        }

        .status-message.info {
            background: #fff5e6;
            color: #ff8c00;
            border: 2px solid #ffa500;
            display: block;
        }

        .camera-info {
            color: white;
            text-align: center;
            margin-top: 10px;
            font-size: 13px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.5em;
            }

            .button-grid {
                grid-template-columns: 1fr;
            }

            .camera-container {
                max-width: 400px;
            }

            #video, #capturedImage {
                max-width: 400px;
            }

            .camera-controls {
                flex-direction: column;
                width: 100%;
                max-width: 400px;
            }

            .camera-btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .camera-container {
                max-width: 320px;
            }

            #video, #capturedImage {
                max-width: 320px;
            }

            .camera-controls {
                max-width: 320px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì∏ Digital Frame Photo Generator</h1>

        <!-- Status Message -->
        <div id="statusMessage" class="status-message"></div>

        <!-- Canvas -->
        <div class="canvas-wrapper">
            <canvas id="canvas"></canvas>
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p style="margin-top: 10px; color: #ff8c00;">Processing...</p>
            </div>
        </div>

        <!-- Upload Section -->
        <div class="action-section">
            <h3>üì§ Upload Your Photo</h3>
            <div class="button-grid">
                <input type="file" id="fileInput" accept="image/*">
                
                <button class="btn btn-camera" id="openCameraBtn">
                    üì∑ Take Selfie
                </button>
                
                <button class="btn btn-upload" onclick="document.getElementById('fileInput').click()">
                    üìÅ Upload Photo
                </button>
            </div>
        </div>

        <!-- Adjustment Section -->
        <div class="adjustment-section" id="adjustmentSection">
            <h3>üéØ Adjust Your Photo</h3>
            <div class="adjustment-controls">
                <div class="slider-group">
                    <div class="slider-label">
                        <span>üìè Photo Size</span>
                        <span class="slider-value" id="scaleValue">100%</span>
                    </div>
                    <input type="range" id="photoScale" class="slider" min="50" max="200" value="100" oninput="updatePhotoAdjustments()">
                </div>

                <div class="slider-group">
                    <div class="slider-label">
                        <span>‚ÜïÔ∏è Vertical Position</span>
                        <span class="slider-value" id="posYValue">0</span>
                    </div>
                    <input type="range" id="photoY" class="slider" min="-200" max="200" value="0" oninput="updatePhotoAdjustments()">
                </div>

                <div class="slider-group">
                    <div class="slider-label">
                        <span>‚ÜîÔ∏è Horizontal Position</span>
                        <span class="slider-value" id="posXValue">0</span>
                    </div>
                    <input type="range" id="photoX" class="slider" min="-200" max="200" value="0" oninput="updatePhotoAdjustments()">
                </div>
            </div>
        </div>

        <!-- Share Section -->
        <div class="share-section" id="shareSection">
            <h3>üì§ Share Your Photo</h3>
            <div class="button-grid">
                <button class="btn btn-share" id="shareBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
                    </svg>
                    Share
                </button>
            </div>
        </div>

        <!-- Reset Button -->
        <div class="button-grid">
            <button class="btn btn-reset" id="resetBtn">
                üîÑ Start Over
            </button>
        </div>
    </div>

    <!-- Camera Modal -->
    <div class="camera-modal" id="cameraModal">
        <div class="camera-container">
            <video id="video" autoplay playsinline></video>
            <img id="capturedImage" />
            <canvas id="captureCanvas"></canvas>
        </div>
        <div class="camera-info" id="cameraInfo">Position yourself and click capture</div>
        <div class="camera-controls">
            <button class="camera-btn capture-btn" id="captureBtn">
                üì∏ Capture
            </button>
            <button class="camera-btn retake-btn" id="retakeBtn" style="display: none;">
                üîÑ Retake
            </button>
            <button class="camera-btn use-photo-btn" id="usePhotoBtn" style="display: none;">
                ‚úÖ Use Photo
            </button>
            <button class="camera-btn switch-camera-btn" id="switchCameraBtn">
                üîÑ Switch
            </button>
            <button class="camera-btn close-camera-btn" id="closeCameraBtn">
                ‚ùå Close
            </button>
        </div>
    </div>

    <script>
        // ========================================
        // CONFIGURATION
        // ========================================
        const CONFIG = {
            frameImage: 'digitalframe.png',
            // Auto-detect circle - will be set when frame loads
            circle: {
                centerX: null,
                centerY: null,
                radius: null
            }
        };

        // ========================================
        // GLOBAL VARIABLES
        // ========================================
        let canvas, ctx;
        let frameImg = null;
        let userPhoto = null;
        let finalImageDataUrl = null;

        // Photo adjustment settings
        let photoAdjustments = {
            scale: 1,
            offsetX: 0,
            offsetY: 0
        };

        // Camera variables
        let videoStream = null;
        let currentFacingMode = 'user';
        let capturedImageData = null;

        // ========================================
        // INITIALIZATION
        // ========================================
        document.addEventListener('DOMContentLoaded', function() {
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            
            loadFrameImage();
            bindEvents();
        });

        // ========================================
        // FRAME LOADING
        // ========================================
        function loadFrameImage() {
            showLoading(true);
            frameImg = new Image();
            
            frameImg.onload = function() {
                canvas.width = frameImg.width;
                canvas.height = frameImg.height;
                
                // Auto-detect circle in center
                CONFIG.circle = {
                    centerX: frameImg.width / 2,
                    centerY: frameImg.height / 2,
                    radius: Math.min(frameImg.width, frameImg.height) * 0.35
                };
                
                drawCanvas();
                showLoading(false);
                showStatus('Frame loaded! Take a photo or upload one to begin.', 'info');
            };
            
            frameImg.onerror = function() {
                showLoading(false);
                showStatus('Error loading frame image. Please check if digitalframe.png exists.', 'error');
            };
            
            frameImg.src = CONFIG.frameImage;
        }

        // ========================================
        // CAMERA FUNCTIONS
        // ========================================
        async function openCamera() {
            const modal = document.getElementById('cameraModal');
            const video = document.getElementById('video');
            
            modal.classList.add('active');
            
            try {
                const constraints = {
                    video: {
                        facingMode: currentFacingMode,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: false
                };
                
                videoStream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = videoStream;
                
                showStatus('Camera ready! Position yourself and click capture.', 'success');
            } catch (error) {
                console.error('Camera error:', error);
                showStatus('Unable to access camera. Please check permissions.', 'error');
                closeCamera();
            }
        }

        function capturePhoto() {
            const video = document.getElementById('video');
            const captureCanvas = document.getElementById('captureCanvas');
            const capturedImage = document.getElementById('capturedImage');
            const captureBtn = document.getElementById('captureBtn');
            const retakeBtn = document.getElementById('retakeBtn');
            const usePhotoBtn = document.getElementById('usePhotoBtn');
            const cameraInfo = document.getElementById('cameraInfo');
            
            captureCanvas.width = video.videoWidth;
            captureCanvas.height = video.videoHeight;
            
            const captureCtx = captureCanvas.getContext('2d');
            
            // Mirror effect for selfie
            captureCtx.translate(captureCanvas.width, 0);
            captureCtx.scale(-1, 1);
            captureCtx.drawImage(video, 0, 0);
            
            capturedImageData = captureCanvas.toDataURL('image/png');
            
            capturedImage.src = capturedImageData;
            capturedImage.style.display = 'block';
            video.style.display = 'none';
            
            captureBtn.style.display = 'none';
            retakeBtn.style.display = 'inline-flex';
            usePhotoBtn.style.display = 'inline-flex';
            
            cameraInfo.textContent = 'Like this photo? Use it or retake.';
        }

        function retakePhoto() {
            const video = document.getElementById('video');
            const capturedImage = document.getElementById('capturedImage');
            const captureBtn = document.getElementById('captureBtn');
            const retakeBtn = document.getElementById('retakeBtn');
            const usePhotoBtn = document.getElementById('usePhotoBtn');
            const cameraInfo = document.getElementById('cameraInfo');
            
            video.style.display = 'block';
            capturedImage.style.display = 'none';
            
            captureBtn.style.display = 'inline-flex';
            retakeBtn.style.display = 'none';
            usePhotoBtn.style.display = 'none';
            
            cameraInfo.textContent = 'Position yourself and click capture';
            capturedImageData = null;
        }

        function usePhoto() {
            if (!capturedImageData) return;
            
            const img = new Image();
            img.onload = function() {
                userPhoto = img;
                resetAdjustments();
                drawPhotoInCircle();
                closeCamera();
                showStatus('Photo captured! Adjust position and size as needed.', 'success');
                document.getElementById('adjustmentSection').classList.add('active');
                document.getElementById('shareSection').classList.add('active');
            };
            img.src = capturedImageData;
        }

        async function switchCamera() {
            currentFacingMode = currentFacingMode === 'user' ? 'environment' : 'user';
            
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
            }
            
            await openCamera();
        }

        function closeCamera() {
            const modal = document.getElementById('cameraModal');
            const video = document.getElementById('video');
            const capturedImage = document.getElementById('capturedImage');
            
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
                videoStream = null;
            }
            
            video.srcObject = null;
            video.style.display = 'block';
            capturedImage.style.display = 'none';
            capturedImageData = null;
            
            document.getElementById('captureBtn').style.display = 'inline-flex';
            document.getElementById('retakeBtn').style.display = 'none';
            document.getElementById('usePhotoBtn').style.display = 'none';
            
            modal.classList.remove('active');
        }

        // ========================================
        // EVENT BINDINGS
        // ========================================
        function bindEvents() {
            document.getElementById('openCameraBtn').addEventListener('click', openCamera);
            document.getElementById('captureBtn').addEventListener('click', capturePhoto);
            document.getElementById('retakeBtn').addEventListener('click', retakePhoto);
            document.getElementById('usePhotoBtn').addEventListener('click', usePhoto);
            document.getElementById('switchCameraBtn').addEventListener('click', switchCamera);
            document.getElementById('closeCameraBtn').addEventListener('click', closeCamera);
            
            document.getElementById('fileInput').addEventListener('change', handleFileSelect);
            document.getElementById('shareBtn').addEventListener('click', shareImage);
            document.getElementById('resetBtn').addEventListener('click', resetAll);
        }

        // ========================================
        // FILE UPLOAD
        // ========================================
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showStatus('Please select an image file', 'error');
                return;
            }
            
            showLoading(true);
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    userPhoto = img;
                    resetAdjustments();
                    drawPhotoInCircle();
                    showLoading(false);
                    showStatus('Photo uploaded! Adjust position and size as needed.', 'success');
                    document.getElementById('adjustmentSection').classList.add('active');
                    document.getElementById('shareSection').classList.add('active');
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
            
            e.target.value = '';
        }

        // ========================================
        // PHOTO ADJUSTMENTS
        // ========================================
        function updatePhotoAdjustments() {
            photoAdjustments.scale = parseInt(document.getElementById('photoScale').value) / 100;
            photoAdjustments.offsetX = parseInt(document.getElementById('photoX').value);
            photoAdjustments.offsetY = parseInt(document.getElementById('photoY').value);
            
            document.getElementById('scaleValue').textContent = Math.round(photoAdjustments.scale * 100) + '%';
            document.getElementById('posXValue').textContent = photoAdjustments.offsetX;
            document.getElementById('posYValue').textContent = photoAdjustments.offsetY;
            
            drawPhotoInCircle();
        }

        function resetAdjustments() {
            photoAdjustments = {
                scale: 1,
                offsetX: 0,
                offsetY: 0
            };
            
            document.getElementById('photoScale').value = 100;
            document.getElementById('photoX').value = 0;
            document.getElementById('photoY').value = 0;
            
            document.getElementById('scaleValue').textContent = '100%';
            document.getElementById('posXValue').textContent = '0';
            document.getElementById('posYValue').textContent = '0';
        }

        // ========================================
        // DRAWING FUNCTION - CIRCULAR PHOTO
        // ========================================
        function drawPhotoInCircle() {
            if (!userPhoto || !frameImg) return;
            
            drawCanvas();
            finalImageDataUrl = canvas.toDataURL('image/png');
        }

        function drawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw user photo in circle FIRST (behind frame)
            if (userPhoto) {
                ctx.save();
                
                // Create circular clipping path
                ctx.beginPath();
                ctx.arc(
                    CONFIG.circle.centerX, 
                    CONFIG.circle.centerY, 
                    CONFIG.circle.radius,
                    0, 
                    Math.PI * 2
                );
                ctx.closePath();
                ctx.clip();
                
                // Calculate dimensions to cover the circle area with adjustments
                const diameter = CONFIG.circle.radius * 2;
                const photoAspect = userPhoto.width / userPhoto.height;
                
                let drawWidth, drawHeight;
                
                // Scale to cover the circle completely
                if (photoAspect > 1) {
                    // Landscape photo
                    drawHeight = diameter * photoAdjustments.scale;
                    drawWidth = drawHeight * photoAspect;
                } else {
                    // Portrait or square photo
                    drawWidth = diameter * photoAdjustments.scale;
                    drawHeight = drawWidth / photoAspect;
                }
                
                // Ensure coverage
                if (drawWidth < diameter * photoAdjustments.scale) {
                    drawWidth = diameter * photoAdjustments.scale;
                    drawHeight = drawWidth / photoAspect;
                }
                if (drawHeight < diameter * photoAdjustments.scale) {
                    drawHeight = diameter * photoAdjustments.scale;
                    drawWidth = drawHeight * photoAspect;
                }
                
                // Center the photo in the circle with adjustments
                const photoX = CONFIG.circle.centerX - drawWidth / 2 + photoAdjustments.offsetX;
                const photoY = CONFIG.circle.centerY - drawHeight / 2 + photoAdjustments.offsetY;
                
                // Draw the photo
                ctx.drawImage(
                    userPhoto,
                    photoX,
                    photoY,
                    drawWidth,
                    drawHeight
                );
                
                ctx.restore();
            }
            
            // Draw frame ON TOP
            if (frameImg) {
                ctx.drawImage(frameImg, 0, 0, canvas.width, canvas.height);
            }
        }

        // ========================================
        // SHARING FUNCTION
        // ========================================
        async function shareImage() {
            if (!finalImageDataUrl) {
                showStatus('Please upload or capture a photo first', 'error');
                return;
            }
            
            try {
                const blob = await (await fetch(finalImageDataUrl)).blob();
                const file = new File([blob], 'framed-photo.png', { type: 'image/png' });
                
                if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                    await navigator.share({
                        files: [file],
                        title: 'Digital Frame Photo',
                        text: '#WAAW2025'
                    });
                    showStatus('Shared successfully!', 'success');
                } else {
                    // Fallback - download the image
                    const link = document.createElement('a');
                    link.download = `framed-photo-${Date.now()}.png`;
                    link.href = finalImageDataUrl;
                    link.click();
                    showStatus('Image downloaded! You can share it from your gallery.', 'info');
                }
            } catch (error) {
                console.error('Share error:', error);
                // Fallback - download the image
                const link = document.createElement('a');
                link.download = `framed-photo-${Date.now()}.png`;
                link.href = finalImageDataUrl;
                link.click();
                showStatus('Image downloaded! You can share it from your gallery.', 'info');
            }
        }

        // ========================================
        // RESET FUNCTION
        // ========================================
        function resetAll() {
            userPhoto = null;
            finalImageDataUrl = null;
            resetAdjustments();
            
            document.getElementById('adjustmentSection').classList.remove('active');
            document.getElementById('shareSection').classList.remove('active');
            
            drawCanvas();
            showStatus('Reset complete. Upload a new photo to begin.', 'info');
        }

        // ========================================
        // UTILITY FUNCTIONS
        // ========================================
        function showLoading(show) {
            document.getElementById('loading').classList.toggle('active', show);
        }

        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = 'status-message ' + type;
            
            setTimeout(() => {
                statusEl.className = 'status-message';
            }, 5000);
        }
    </script>
</body>
</html>
